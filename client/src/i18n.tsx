import React from "react";

export type Locale = "he" | "en";

const LOCALE_STORAGE_KEY = "horn-locale";
type Dict = Record<string, string>;

const he: Dict = {
  "app.title": "הורן - מרכז שליטה",
  "nav.command_center": "מרכז פיקוד",
  "nav.alerts_history": "היסטוריית התראות",
  "nav.team": "הצוות",
  "nav.my_dashboard": "הדשבורד שלי",
  "nav.my_responses": "התגובות שלי",
  "nav.profile": "פרופיל",
  "theme.light": "מצב בהיר",
  "theme.dark": "מצב כהה",
  "lang.he": "עברית",
  "lang.en": "English",
  "status.ALL": "הכול",
  "status.OK": "תקין",
  "status.HELP": "סיוע",
  "status.PENDING": "ממתין",
  "toast.error": "שגיאה",
  "toast.success": "הצלחה",
  "toast.info": "עדכון",
  "toast.warning": "אזהרה",
  "auth.login.title": "כניסה למערכת",
  "auth.login.subtitle": "התחבר כדי להמשיך למרכז השליטה.",
  "auth.login.email": "אימייל",
  "auth.login.password": "סיסמה",
  "auth.login.submit": "כניסה",
  "auth.login.submitting": "מתחבר...",
  "auth.login.no_account": "אין לך חשבון?",
  "auth.login.register_now": "הירשם עכשיו",
  "auth.register.title": "יצירת חשבון חדש",
  "auth.register.subtitle": "מלא את הפרטים ונחבר אותך מיד למרכז השליטה.",
  "auth.register.name": "שם מלא",
  "auth.register.email": "אימייל",
  "auth.register.password": "סיסמה",
  "auth.register.phone": "טלפון (אופציונלי)",
  "auth.register.area": "אזור שירות",
  "auth.register.select_area": "בחר אזור",
  "auth.register.submit": "הירשם",
  "auth.register.submitting": "יוצר חשבון...",
  "auth.register.have_account": "כבר יש לך חשבון?",
  "auth.register.login": "התחבר",
  "profile.title": "פרופיל",
  "profile.subtitle": "ניהול פרטים, התראות ויציאה מהמערכת.",
  "profile.user_details": "פרטי משתמש",
  "profile.name": "שם",
  "profile.email": "אימייל",
  "profile.phone": "טלפון",
  "profile.area": "אזור",
  "profile.edit_hint": "אפשר לעדכן שם וטלפון ישירות כאן.",
  "profile.save": "שמור פרטים",
  "profile.saving": "שומר...",
  "profile.updated": "הפרטים עודכנו בהצלחה.",
  "profile.update_failed": "עדכון הפרטים נכשל.",
  "profile.name_placeholder": "הזן שם מלא",
  "profile.phone_placeholder": "הזן מספר טלפון",
  "profile.not_available": "לא זמין",
  "profile.not_set": "לא הוגדר",
  "profile.notifications": "התראות",
  "profile.notifications_hint": "אפשר התראות כדי לקבל עדכון מיידי בזמן אירוע.",
  "profile.notifications_enabled": "התראות פעילות",
  "profile.notifications_enable": "אפשר התראות",
  "profile.notifications_test": "שלח התראת בדיקה",
  "profile.actions": "פעולות",
  "profile.logout": "התנתק",
  "profile.logging_out": "מתנתק...",
  "error.enable_notifications": "לא ניתן לאפשר התראות בדפדפן זה.",
  "error.login": "שגיאה בהתחברות",
  "error.register": "שגיאה בהרשמה",
  "error.required_fields": "נא למלא את כל השדות",
  "error.required_fields_register": "נא למלא את כל שדות החובה",
  "error.invalid_email": "נא להזין אימייל תקין",
  "error.invalid_name": "נא להזין שם מלא",
  "error.invalid_password": "הסיסמה אינה תקינה",
  "auth.expired": "תוקף ההתחברות פג. התחבר מחדש.",
  "demo.nav": "דמו משקיעים",
  /**
   * WCAG 2.1 AA Compliance Strings
   * Accessibility-related messages for compliance with Israeli Standard 5568
   */
  "a11y.skip_to_main": "דלג לתוכן הראשי",
  "a11y.settings": "הגדרות נגישות",
  "nav.settings": "הגדרות",
  "nav.main_navigation": "ניווט עיקרי",
  "nav.logo_home": "הורן - עמוד הבית",
  "nav.skip_link": "דלג לתוכן ראשי",
  "a11y.close": "סגור",
  "a11y.menu": "תפריט",
  "a11y.button": "כפתור",
  "demo.live_split_title": "דמו מפוצל חי",
  "demo.live_split_subtitle": "הדמיה בזמן אמת למפקד ולחייל בלי רענון ידני.",
  "demo.socket_live": "סוקט פעיל",
  "demo.socket_reconnecting": "מתחבר לסוקט",
  "demo.layout_stacked": "מעל/מתחת",
  "demo.layout_side_by_side": "ליד/ליד",
  "demo.commander_panel": "מפקד",
  "demo.soldier_panel": "חייל",
  "demo.investor_preview": "תצוגת משקיעים",
  "demo.investor_title": "דמו חי - Horn",
  "demo.investor_subtitle": "כניסה מיידית למערכת הדגמה ללא הרשמה או התחברות ידנית.",
  "demo.investor_subtitle_2": "המסך יטען תצוגת מפקד וחייל באותו עמוד.",
  "demo.enter": "כניסה לדמו",
  "demo.preparing": "מכין דמו...",
  "demo.session_ready": "סשן הדגמה מוכן",
  "demo.unable_start": "לא ניתן להתחיל סשן הדגמה",
  "cc.title": "מרכז פיקוד",
  "cc.run_test_scenario": "הפעל תרחיש בדיקה",
  "cc.running_demo": "מריץ דמו...",
  "cc.starting_test": "מתחיל תרחיש בדיקה...",
  "cc.failed_test": "הפעלת תרחיש נכשלה",
  "cc.demo_started_for": "תרחיש דמו הופעל עבור",
  "cc.demo_queued": "תגובות מדומות הוכנסו לתור",
  "cc.alert_action": "ירוק בעיניים",
  "cc.active_events_count": "אירועים פעילים",
  "cc.critical_count": "דורשים תשומת לב מיידית",
  "cc.ok": "מאושרים",
  "cc.help": "זקוקים לעזרה",
  "cc.pending": "ממתינים",
  "cc.response_rate": "שיעור תגובה",
  "cc.active_events": "אירועים פעילים",
  "cc.response": "תגובה",
  "cc.calm_title": "הכל רגוע",
  "cc.calm_subtitle": "אין אירועים פעילים כרגע",
  "cc.close_event": "סגור אירוע",
  "cc.approved": "אישרו",
  "cc.need_help": "זקוקים לעזרה",
  "cc.waiting": "ממתינים",
  "cc.select_event": "בחר אירוע מהרשימה",
  "cc.new_event_title": "הקפצת אירוע חדש",
  "cc.select_area": "בחר גזרה",
  "cc.cancel": "ביטול",
  "cc.sending": "שולח...",
  "cc.trigger_event": "הקפץ אירוע",
  "cc.close_event_title": "סגירת אירוע",
  "cc.close_event_confirm": "האם אתה בטוח שברצונך לסגור את האירוע? ניתן להוסיף סיבה לסגירה.",
  "cc.close_reason_placeholder": "סיבה לסגירה (אופציונלי)",
  "cc.closing": "סוגר...",
  "sd.title": "הדשבורד שלי",
  "sd.events_in_area": "אירועים בגזרה",
  "sd.ok_reports": "דיווחי בסדר",
  "sd.help_requests": "בקשות עזרה",
  "sd.my_area_events": "אירועים בגזרה שלי",
  "sd.loading": "טוען...",
  "sd.no_events_title": "הכל רגוע",
  "sd.no_events_subtitle": "אין אירועים בגזרה שלך",
  "sd.reported_ok": "דיווחתי בסדר",
  "sd.reported_help": "דיווחתי צורך בעזרה",
  "sd.report_status_ok": "דיווחת שהכל בסדר",
  "sd.report_status_help": "דיווחת שאתה צריך עזרה",
  "sd.your_note": "ההערה שלך:",
  "sd.update_response_q": "רוצה לעדכן את התגובה שלך?",
  "sd.update_response_action": "לחץ כאן לשינוי תגובה",
  "sd.how_feel": "איך אתה מרגיש?",
  "sd.how_feel_sub": "דווח על מצבך כדי שהמפקדים ידעו שאתה בטוח",
  "sd.i_am_ok": "הכל בסדר",
  "sd.i_am_ok_sub": "אני בטוח ולא צריך עזרה",
  "sd.need_help": "צריך עזרה",
  "sd.need_help_sub": "אני זקוק לסיוע מיידי",
  "sd.notes_optional": "הערות (אופציונלי)",
  "sd.notes_placeholder": "הוסף הערות או פרטים נוספים...",
  "sd.select_event": "בחר אירוע מהרשימה",
  "area.generic": "גזרה",
  "area.jerusalem": "ירושלים והסביבה",
  "area.gush-dan": "גוש דן",
  "area.hashfela": "השפלה",
  "area.hasharon": "השרון",
  "area.shomron": "השומרון",
  "area.lakhish": "לכיש",
  "area.otef-aza": "עוטף עזה",
  "area.negev": "הנגב",
  "area.galil-elyon": "גליל עליון",
  "area.galil-tahton": "גליל תחתון",
  "area.haifa-krayot": "חיפה והקריות",
  "area.emek-yizrael": "עמק יזרעאל",
  "area.arava": "הערבה",
  "area.eilat": "אילת",
};

const en: Dict = {
  "app.title": "Horn - Control Center",
  "nav.command_center": "Command Center",
  "nav.alerts_history": "Alerts History",
  "nav.team": "Team",
  "nav.my_dashboard": "My Dashboard",
  "nav.my_responses": "My Responses",
  "nav.profile": "Profile",
  "theme.light": "Light mode",
  "theme.dark": "Dark mode",
  "lang.he": "Hebrew",
  "lang.en": "English",
  "status.ALL": "All",
  "status.OK": "OK",
  "status.HELP": "Help",
  "status.PENDING": "Pending",
  "toast.error": "Error",
  "toast.success": "Success",
  "toast.info": "Info",
  "toast.warning": "Warning",
  "auth.login.title": "Sign In",
  "auth.login.subtitle": "Sign in to continue to the control center.",
  "auth.login.email": "Email",
  "auth.login.password": "Password",
  "auth.login.submit": "Sign In",
  "auth.login.submitting": "Signing in...",
  "auth.login.no_account": "Don't have an account?",
  "auth.login.register_now": "Register now",
  "auth.register.title": "Create New Account",
  "auth.register.subtitle": "Fill in your details and connect instantly to control center.",
  "auth.register.name": "Full name",
  "auth.register.email": "Email",
  "auth.register.password": "Password",
  "auth.register.phone": "Phone (optional)",
  "auth.register.area": "Service area",
  "auth.register.select_area": "Select area",
  "auth.register.submit": "Register",
  "auth.register.submitting": "Creating account...",
  "auth.register.have_account": "Already have an account?",
  "auth.register.login": "Login",
  "profile.title": "Profile",
  "profile.subtitle": "Manage details, notifications and logout.",
  "profile.user_details": "User Details",
  "profile.name": "Name",
  "profile.email": "Email",
  "profile.phone": "Phone",
  "profile.area": "Area",
  "profile.edit_hint": "Update your name and phone here.",
  "profile.save": "Save details",
  "profile.saving": "Saving...",
  "profile.updated": "Profile updated successfully.",
  "profile.update_failed": "Failed to update profile.",
  "profile.name_placeholder": "Enter full name",
  "profile.phone_placeholder": "Enter phone number",
  "profile.not_available": "Not available",
  "profile.not_set": "Not set",
  "profile.notifications": "Notifications",
  "profile.notifications_hint": "Enable notifications to receive immediate event updates.",
  "profile.notifications_enabled": "Notifications enabled",
  "profile.notifications_enable": "Enable notifications",
  "profile.notifications_test": "Send test notification",
  "profile.actions": "Actions",
  "profile.logout": "Logout",
  "profile.logging_out": "Logging out...",
  "error.enable_notifications": "Cannot enable notifications in this browser.",
  "error.login": "Login failed",
  "error.register": "Registration failed",
  /**
   * WCAG 2.1 AA Compliance Strings
   */
  "a11y.skip_to_main": "Skip to main content",
  "a11y.settings": "Accessibility Settings",
  "nav.settings": "Settings",
  "nav.main_navigation": "Main Navigation",
  "nav.logo_home": "Horn - Home",
  "nav.skip_link": "Skip to main content",
  "a11y.close": "Close",
  "a11y.menu": "Menu",
  "a11y.button": "Button",
  "error.required_fields": "Please fill all fields",
  "error.required_fields_register": "Please fill all required fields",
  "error.invalid_email": "Please enter a valid email",
  "error.invalid_name": "Please enter full name",
  "error.invalid_password": "Password is invalid",
  "auth.expired": "Session expired. Please login again.",
  "demo.nav": "Investor Demo",
  "demo.live_split_title": "Live Split Demo",
  "demo.live_split_subtitle": "Real-time simulation for commander and soldier without manual refresh.",
  "demo.socket_live": "Socket Live",
  "demo.socket_reconnecting": "Socket Reconnecting",
  "demo.layout_stacked": "Top/Bottom",
  "demo.layout_side_by_side": "Side by side",
  "demo.commander_panel": "Commander",
  "demo.soldier_panel": "Soldier",
  "demo.investor_preview": "Investor Preview",
  "demo.investor_title": "Horn Live Demo",
  "demo.investor_subtitle": "Instant access to demo mode without manual registration or login.",
  "demo.investor_subtitle_2": "The screen loads commander and soldier views on the same page.",
  "demo.enter": "Enter Demo",
  "demo.preparing": "Preparing demo...",
  "demo.session_ready": "Demo session is ready",
  "demo.unable_start": "Unable to start demo session",
  "cc.title": "Command Center",
  "cc.run_test_scenario": "Run Test Scenario",
  "cc.running_demo": "Running demo...",
  "cc.starting_test": "Starting test scenario...",
  "cc.failed_test": "Failed to start test scenario",
  "cc.demo_started_for": "Demo scenario started for",
  "cc.demo_queued": "simulated responses queued",
  "cc.alert_action": "Green alert",
  "cc.active_events_count": "active events",
  "cc.critical_count": "need immediate attention",
  "cc.ok": "Approved",
  "cc.help": "Need help",
  "cc.pending": "Pending",
  "cc.response_rate": "Response rate",
  "cc.active_events": "Active events",
  "cc.response": "Response",
  "cc.calm_title": "All clear",
  "cc.calm_subtitle": "No active events right now",
  "cc.close_event": "Close Event",
  "cc.approved": "Approved",
  "cc.need_help": "Need help",
  "cc.waiting": "Waiting",
  "cc.select_event": "Choose an event from the list",
  "cc.new_event_title": "Trigger New Event",
  "cc.select_area": "Select Area",
  "cc.cancel": "Cancel",
  "cc.sending": "Sending...",
  "cc.trigger_event": "Trigger Event",
  "cc.close_event_title": "Close Event",
  "cc.close_event_confirm": "Are you sure you want to close this event? You can add a reason.",
  "cc.close_reason_placeholder": "Reason for closing (optional)",
  "cc.closing": "Closing...",
  "sd.title": "My Dashboard",
  "sd.events_in_area": "Events in area",
  "sd.ok_reports": "OK reports",
  "sd.help_requests": "Help requests",
  "sd.my_area_events": "Events in my area",
  "sd.loading": "Loading...",
  "sd.no_events_title": "All clear",
  "sd.no_events_subtitle": "No events in your area",
  "sd.reported_ok": "Reported OK",
  "sd.reported_help": "Reported need help",
  "sd.report_status_ok": "You reported all good",
  "sd.report_status_help": "You reported need help",
  "sd.your_note": "Your note:",
  "sd.update_response_q": "Want to update your response?",
  "sd.update_response_action": "Click here to update response",
  "sd.how_feel": "How do you feel?",
  "sd.how_feel_sub": "Report your status so commanders know you are safe",
  "sd.i_am_ok": "I'm OK",
  "sd.i_am_ok_sub": "I am safe and need no help",
  "sd.need_help": "Need Help",
  "sd.need_help_sub": "I need immediate assistance",
  "sd.notes_optional": "Notes (optional)",
  "sd.notes_placeholder": "Add notes or extra details...",
  "sd.select_event": "Select an event from the list",
  "area.generic": "Area",
  "area.jerusalem": "Jerusalem and surroundings",
  "area.gush-dan": "Gush Dan",
  "area.hashfela": "Shfela",
  "area.hasharon": "Sharon",
  "area.shomron": "Shomron",
  "area.lakhish": "Lakhish",
  "area.otef-aza": "Gaza Envelope",
  "area.negev": "Negev",
  "area.galil-elyon": "Upper Galilee",
  "area.galil-tahton": "Lower Galilee",
  "area.haifa-krayot": "Haifa and Krayot",
  "area.emek-yizrael": "Jezreel Valley",
  "area.arava": "Arava",
  "area.eilat": "Eilat",
};

const resources: Record<Locale, Dict> = { he, en };

function getStoredLocale(): Locale {
  const stored = localStorage.getItem(LOCALE_STORAGE_KEY);
  return stored === "en" ? "en" : "he";
}

function rawTranslate(locale: Locale, key: string) {
  return resources[locale][key] ?? resources.he[key] ?? key;
}

type I18nCtx = {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: string) => string;
};

const I18nContext = React.createContext<I18nCtx>({
  locale: "he",
  setLocale: () => undefined,
  t: (key) => key,
});

export const I18nProvider: React.FC<React.PropsWithChildren> = ({ children }) => {
  const [locale, setLocaleState] = React.useState<Locale>(getStoredLocale);

  const setLocale = React.useCallback((next: Locale) => {
    setLocaleState(next);
    localStorage.setItem(LOCALE_STORAGE_KEY, next);
    document.documentElement.lang = next;
    document.documentElement.dir = next === "he" ? "rtl" : "ltr";
  }, []);

  React.useEffect(() => {
    document.documentElement.lang = locale;
    document.documentElement.dir = locale === "he" ? "rtl" : "ltr";
  }, [locale]);

  const value = React.useMemo<I18nCtx>(
    () => ({
      locale,
      setLocale,
      t: (key: string) => rawTranslate(locale, key),
    }),
    [locale, setLocale],
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export function useI18n() {
  return React.useContext(I18nContext);
}

export function tStatic(key: string) {
  return rawTranslate(getStoredLocale(), key);
}
